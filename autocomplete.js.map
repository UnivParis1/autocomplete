{"version":3,"file":"autocomplete.js","sources":["autocomplete.ts"],"sourcesContent":["/**\n * Copyright (c) 2016 Denys Krasnoshchok\n * \n * Homepage: https://smartscheduling.com/en/documentation/autocomplete\n * Source: https://github.com/kraaden/autocomplete\n * \n * MIT License\n */\n\nexport const enum EventTrigger {\n    Keyboard = 0,\n    Focus = 1,\n    Mouse = 2,\n    /**\n     * Fetch is triggered manually by calling `fetch` function returned in `AutocompleteResult`\n     */\n    Manual = 3\n}\n\n/**\n * Enum for controlling form submission when `ENTER` key is pressed in the autocomplete input field.\n */\nexport const enum PreventSubmit {\n    Never = 0,\n    Always = 1,\n    /**\n     * Form submission is prevented only when an item is selected from the autocomplete list.\n     */\n    OnSelect = 2\n}\n\nexport interface AutocompleteItem {\n    label?: string;\n    group?: string;\n}\n\nexport interface AutocompleteEvent<T extends Event> {\n    /**\n     * Native event object passed by browser to the event handler\n     */\n    event: T;\n\n    /**\n     * Fetch data and display autocomplete\n     */\n    fetch: () => void;\n}\n\nexport interface AutocompleteSettings<T extends AutocompleteItem> {\n    /**\n     * Autocomplete will be attached to this element.\n     */\n    input: HTMLInputElement | HTMLTextAreaElement;\n\n    /**\n     * Provide your own container for the widget.\n     * If not specified, a new DIV element will be created.\n     */\n    container?: HTMLDivElement;\n\n    /**\n     * This method allows you to override the default rendering function for items.\n     * It must return a DIV element or undefined to skip rendering.\n     */\n    render?: (item: T, currentValue: string, index: number) => HTMLDivElement | undefined;\n\n    /**\n     * This method allows you to override the default rendering function for item groups.\n     * It must return a DIV element or undefined to skip rendering.\n     */\n    renderGroup?: (name: string, currentValue: string) => HTMLDivElement | undefined;\n\n    /**\n     * If specified, the autocomplete DOM element will have this class assigned to it.\n     */\n    className?: string;\n\n    /**\n     * Specify the minimum text length required to show autocomplete.\n     */\n    minLength?: number;\n\n    /**\n     * The message that will be showed when there are no suggestions that match the entered value.\n     */\n    emptyMsg?: string;\n\n    /**\n     * This method will be called when user choose an item in autocomplete. The selected item will be passed as the first parameter.\n     */\n    onSelect: (item: T, input: HTMLInputElement | HTMLTextAreaElement) => void;\n\n    /**\n     * Show autocomplete on focus event. Focus event will ignore the `minLength` property and will always call `fetch`.\n     */\n    showOnFocus?: boolean;\n\n    /**\n     * This method will be called to prepare suggestions and then pass them to autocomplete.\n     * @param {string} text - text in the input field\n     * @param {(items: T[] | false) => void} update - a callback function that must be called after suggestions are prepared\n     * @param {EventTrigger} trigger - type of the event that triggered the fetch\n     * @param {number} cursorPos - position of the cursor in the input field\n     */\n    fetch: (text: string, update: (items: T[] | false) => void, trigger: EventTrigger, cursorPos: number) => void;\n\n    /**\n     * Enforces that the fetch function will only be called once within the specified time frame (in milliseconds) and\n     * delays execution. This prevents flooding your server with AJAX requests.\n     */\n    debounceWaitMs?: number;\n\n    /**\n     * Callback for additional autocomplete customization\n     * @param {HTMLInputElement | HTMLTextAreaElement} input - input box associated with autocomplete\n     * @param {ClientRect | DOMRect} inputRect - size of the input box and its position relative to the viewport\n     * @param {HTMLDivElement} container - container with suggestions\n     */\n    customize?: (input: HTMLInputElement | HTMLTextAreaElement, inputRect: ClientRect | DOMRect, container: HTMLDivElement) => void;\n\n    /**\n     * Controls form submission when the ENTER key is pressed in a input field.\n     */\n    preventSubmit?: PreventSubmit;\n\n    /**\n     * Prevents the first item in the list from being selected automatically. This option allows you\n     * to submit a custom text by pressing ENTER even when autocomplete is displayed.\n     */\n    disableAutoSelect?: boolean;\n\n    /**\n     * Provide your keyup event handler to display autocomplete when a key is pressed that doesn't modify the content. You can also perform some additional actions.\n     */\n    keyup?: (e: AutocompleteEvent<KeyboardEvent>) => void;\n\n    /**\n     * Allows to display autocomplete on mouse clicks or perform some additional actions.\n     */\n    click?: (e: AutocompleteEvent<MouseEvent>) => void;\n}\n\nexport interface AutocompleteResult {\n    /**\n     * Remove event handlers, DOM elements and ARIA/accessibility attributes created by the widget.\n     */\n    destroy: () => void;\n\n    /**\n     * This function allows to manually start data fetching and display autocomplete. Note that\n     * it does not automatically place focus on the input field, so you may need to do so manually\n     * in certain situations.\n     */\n    fetch: () => void;\n}\n\nexport default function autocomplete<T extends AutocompleteItem>(settings: AutocompleteSettings<T>): AutocompleteResult {\n\n    // just an alias to minimize JS file size\n    const doc = document;\n\n    const container: HTMLDivElement = settings.container || doc.createElement('div');\n    const preventSubmit: PreventSubmit = settings.preventSubmit || PreventSubmit.Never;\n\n    container.id = container.id || 'autocomplete-' + uid();\n    const containerStyle = container.style;\n    const debounceWaitMs = settings.debounceWaitMs || 0;\n    const disableAutoSelect = settings.disableAutoSelect || false;\n    const customContainerParent = container.parentElement;\n\n    let items: T[] = [];\n    let inputValue = '';\n    let minLen = 2;\n    const showOnFocus = settings.showOnFocus;\n    let selected: T | undefined;\n    let fetchCounter = 0;\n    let debounceTimer: number | undefined;\n    let destroyed = false;\n\n    // Fixes #104: autocomplete selection is broken on Firefox for Android\n    let suppressAutocomplete = false;\n\n    if (settings.minLength !== undefined) {\n        minLen = settings.minLength;\n    }\n\n    if (!settings.input) {\n        throw new Error('input undefined');\n    }\n\n    const input: HTMLInputElement | HTMLTextAreaElement = settings.input;\n\n    container.className = 'autocomplete ' + (settings.className || '');\n    container.setAttribute('role', 'listbox');\n\n    input.setAttribute('role', 'combobox');\n    input.setAttribute('aria-expanded', 'false');\n    input.setAttribute('aria-autocomplete', 'list');\n    input.setAttribute('aria-controls', container.id);\n    input.setAttribute('aria-owns', container.id);\n    input.setAttribute('aria-activedescendant', '');\n    input.setAttribute('aria-haspopup', 'listbox');\n\n    // IOS implementation for fixed positioning has many bugs, so we will use absolute positioning\n    containerStyle.position = 'absolute';\n\n    /**\n     * Generate a very complex textual ID that greatly reduces the chance of a collision with another ID or text.\n     */\n    function uid(): string {\n        return Date.now().toString(36) + Math.random().toString(36).substring(2);\n    }\n\n    /**\n     * Detach the container from DOM\n     */\n    function detach() {\n        const parent = container.parentNode;\n        if (parent) {\n            parent.removeChild(container);\n        }\n    }\n\n    /**\n     * Clear debouncing timer if assigned\n     */\n    function clearDebounceTimer() {\n        if (debounceTimer) {\n            window.clearTimeout(debounceTimer);\n        }\n    }\n\n    /**\n     * Attach the container to DOM\n     */\n    function attach() {\n        if (!container.parentNode) {\n            (customContainerParent || doc.body).appendChild(container);\n        }\n    }\n\n    /**\n     * Check if container for autocomplete is displayed\n     */\n    function containerDisplayed(): boolean {\n        return !!container.parentNode;\n    }\n\n    /**\n     * Clear autocomplete state and hide container\n     */\n    function clear() {\n        // prevent the update call if there are pending AJAX requests\n        fetchCounter++;\n\n        items = [];\n        inputValue = '';\n        selected = undefined;\n        input.setAttribute('aria-activedescendant', '');\n        input.setAttribute('aria-expanded', 'false');\n        detach();\n    }\n\n    /**\n     * Update autocomplete position\n     */\n    function updatePosition() {\n        if (!containerDisplayed()) {\n            return;\n        }\n\n        input.setAttribute('aria-expanded', 'true');\n\n        containerStyle.height = 'auto';\n        containerStyle.width = input.offsetWidth + 'px';\n\n        let inputRect: DOMRect | undefined;\n\n        function calc() {\n            const docEl = doc.documentElement as HTMLElement;\n            const clientTop = docEl.clientTop || doc.body.clientTop || 0;\n            const clientLeft = docEl.clientLeft || doc.body.clientLeft || 0;\n            const scrollTop = window.pageYOffset || docEl.scrollTop;\n            const scrollLeft = window.pageXOffset || docEl.scrollLeft;\n\n            inputRect = input.getBoundingClientRect();\n\n            const top = inputRect.top + input.offsetHeight + scrollTop - clientTop;\n            const left = inputRect.left + scrollLeft - clientLeft;\n\n            containerStyle.top = top + 'px';\n            containerStyle.left = left + 'px';\n\n            containerStyle.top = top + 'px';\n            containerStyle.bottom = '';\n            containerStyle.left = left + 'px';\n        }\n\n        // the calc method must be called twice, otherwise the calculation may be wrong on resize event (chrome browser)\n        calc();\n        calc();\n\n        // do our best to display all choices\n        container.scrollIntoView({ block: \"nearest\" }) \n        // but ensure the input is still visible\n        input.scrollIntoView({ block: \"nearest\" })\n  \n        if (settings.customize && inputRect) {\n            settings.customize(input, inputRect, container);\n        }\n    }\n\n    /**\n     * Redraw the autocomplete div element with suggestions\n     */\n    function update() {\n\n        container.textContent = '';\n        input.setAttribute('aria-activedescendant', '');\n\n        // function for rendering autocomplete suggestions\n        let render = function (item: T, _: string, __: number): HTMLDivElement | undefined {\n            const itemElement = doc.createElement('div');\n            itemElement.textContent = item.label || '';\n            return itemElement;\n        };\n        if (settings.render) {\n            render = settings.render;\n        }\n\n        // function to render autocomplete groups\n        let renderGroup = function (groupName: string, _: string): HTMLDivElement | undefined {\n            const groupDiv = doc.createElement('div');\n            groupDiv.textContent = groupName;\n            return groupDiv;\n        };\n        if (settings.renderGroup) {\n            renderGroup = settings.renderGroup;\n        }\n\n        const fragment = doc.createDocumentFragment();\n        let prevGroup = uid();\n\n        items.forEach(function (item: T, index: number): void {\n            if (item.group && item.group !== prevGroup) {\n                prevGroup = item.group;\n                const groupDiv = renderGroup(item.group, inputValue);\n                if (groupDiv) {\n                    groupDiv.className += ' group';\n                    fragment.appendChild(groupDiv);\n                }\n            }\n            const div = render(item, inputValue, index);\n            if (div) {\n                div.id = `${container.id}_${index}`;\n                div.setAttribute('role', 'option');\n                div.addEventListener('click', function (ev: MouseEvent): void {\n                    suppressAutocomplete = true;\n                    try {\n                        settings.onSelect(item, input);\n                    } finally {\n                        suppressAutocomplete = false;\n                    }\n                    clear();\n                    ev.preventDefault();\n                    ev.stopPropagation();\n                });\n                if (item === selected) {\n                    div.className += ' selected';\n                    div.setAttribute('aria-selected', 'true');\n                    input.setAttribute('aria-activedescendant', div.id);\n                }\n                fragment.appendChild(div);\n            }\n        });\n        container.appendChild(fragment);\n        if (items.length < 1) {\n            if (settings.emptyMsg) {\n                const empty = doc.createElement('div');\n                empty.id = `${container.id}_${uid()}`;\n                empty.className = 'empty';\n                empty.textContent = settings.emptyMsg;\n                container.appendChild(empty);\n                input.setAttribute('aria-activedescendant', empty.id);\n            } else {\n                clear();\n                return;\n            }\n        }\n\n        attach();\n        updatePosition();\n\n        updateScroll();\n    }\n\n    function inputEventHandler() {\n        if (!suppressAutocomplete) {\n            fetch(EventTrigger.Keyboard);\n        }\n    }\n\n    /**\n     * Automatically move scroll bar if selected item is not visible\n     */\n    function updateScroll() {\n        const elements = container.getElementsByClassName('selected');\n        if (elements.length > 0) {\n            let element = elements[0] as HTMLDivElement;\n            element.scrollIntoView({ block: 'nearest' })\n        }\n    }\n\n    function selectPreviousSuggestion() {\n        const index = items.indexOf(selected!);\n\n        selected = index === -1\n            ? undefined\n            : items[(index + items.length - 1) % items.length];\n\n        updateSelectedSuggestion(index);\n    }\n\n    function selectNextSuggestion() {\n        const index = items.indexOf(selected!);\n\n        selected = items.length < 1\n            ? undefined\n            : index === -1\n                ? items[0]\n                : items[(index + 1) % items.length];\n\n        updateSelectedSuggestion(index);\n    }\n\n    function updateSelectedSuggestion(index: number) {\n        if (items.length > 0) {\n            unselectSuggestion(index);\n            selectSuggestion(items.indexOf(selected!));\n            updateScroll();\n        }\n    }\n\n    function selectSuggestion(index: number) {\n        var element = doc.getElementById(container.id + \"_\" + index);\n        if (element) {\n            element.classList.add('selected');\n            element.setAttribute('aria-selected', 'true');\n            input.setAttribute('aria-activedescendant', element.id);\n        }\n    }\n\n    function unselectSuggestion(index: number) {\n        var element = doc.getElementById(container.id + \"_\" + index);\n        if (element) {\n            element.classList.remove('selected');\n            element.removeAttribute('aria-selected');\n            input.removeAttribute('aria-activedescendant');\n        }\n    }\n\n    function handleArrowAndEscapeKeys(ev: KeyboardEvent, key: 'ArrowUp' | 'ArrowDown' | 'Escape') {\n        const containerIsDisplayed = containerDisplayed();\n\n        if (key === 'Escape') {\n            clear();\n        } else {\n            if (!containerIsDisplayed || items.length < 1) {\n                return;\n            }\n            key === 'ArrowUp'\n                ? selectPreviousSuggestion()\n                : selectNextSuggestion();\n        }\n\n        ev.preventDefault();\n\n        if (containerIsDisplayed) {\n            ev.stopPropagation();\n        }\n    }\n\n    function handleEnterKey(ev: KeyboardEvent) {\n        if (selected) {\n            if (preventSubmit === PreventSubmit.OnSelect) {\n                ev.preventDefault();\n            }\n            suppressAutocomplete = true;\n            try {\n                settings.onSelect(selected, input);\n            } finally {\n                suppressAutocomplete = false;\n            }\n            clear();\n        }\n\n        if (preventSubmit === PreventSubmit.Always) {\n            ev.preventDefault();\n        }\n    }\n\n    function keydownEventHandler(ev: KeyboardEvent) {\n        const key = ev.key;\n\n        switch (key) {\n            case 'ArrowUp':\n            case 'ArrowDown':\n            case 'Escape':\n                handleArrowAndEscapeKeys(ev, key);\n                break;\n            case 'Enter':\n                handleEnterKey(ev);\n                break;\n            default:\n                break;\n        }\n    }\n\n    function focusEventHandler() {\n        if (showOnFocus) {\n            fetch(EventTrigger.Focus);\n        }\n    }\n\n    function fetch(trigger: EventTrigger) {\n        if (input.value.length >= minLen) {\n            clearDebounceTimer();\n            debounceTimer = window.setTimeout(\n                () => startFetch(input.value, trigger, input.selectionStart || 0),\n                trigger === EventTrigger.Keyboard || trigger === EventTrigger.Mouse ? debounceWaitMs : 0);\n        } else {\n            clear();\n        }\n    }\n\n    function startFetch(inputText: string, trigger: EventTrigger, cursorPos: number) {\n        if (destroyed) return;\n        const savedFetchCounter = ++fetchCounter;\n        input.classList.add('ac-loading');\n        settings.fetch(inputText, function (elements: T[] | false): void {\n            input.classList.remove('ac-loading');\n            if (fetchCounter === savedFetchCounter && elements) {\n                items = elements;\n                inputValue = inputText;\n                selected = (items.length < 1 || disableAutoSelect) ? undefined : items[0];\n                update();\n            }\n        }, trigger, cursorPos);\n    }\n\n    function keyupEventHandler(e: KeyboardEvent) {\n        if (settings.keyup) {\n            settings.keyup({\n                event: e,\n                fetch: () => fetch(EventTrigger.Keyboard)\n            });\n            return;\n        }\n\n        if (!containerDisplayed() && e.key === 'ArrowDown') {\n            fetch(EventTrigger.Keyboard);\n        }\n    }\n\n    function clickEventHandler(e: MouseEvent) {\n        settings.click && settings.click({\n            event: e,\n            fetch: () => fetch(EventTrigger.Mouse)\n        });\n    }\n\n    function blurEventHandler() {\n        // when an item is selected by mouse click, the blur event will be initiated before the click event and remove DOM elements,\n        // so that the click event will never be triggered. In order to avoid this issue, DOM removal should be delayed.\n        setTimeout(() => {\n            if (doc.activeElement !== input) {\n                clear();\n            }\n        }, 200);\n    }\n\n    function manualFetch() {\n        startFetch(input.value, EventTrigger.Manual, input.selectionStart || 0);\n    }\n\n    /**\n     * Fixes #26: on long clicks focus will be lost and onSelect method will not be called\n     */\n    container.addEventListener('mousedown', function (evt: Event) {\n        evt.stopPropagation();\n        evt.preventDefault();\n    });\n\n    // If the custom autocomplete container is already appended to the DOM during widget initialization, detach it.\n    detach();\n\n    /**\n     * This function will remove DOM elements and clear event handlers\n     */\n    function destroy() {\n        input.removeEventListener('focus', focusEventHandler);\n        input.removeEventListener('keyup', keyupEventHandler as EventListenerOrEventListenerObject)\n        input.removeEventListener('click', clickEventHandler as EventListenerOrEventListenerObject)\n        input.removeEventListener('keydown', keydownEventHandler as EventListenerOrEventListenerObject);\n        input.removeEventListener('input', inputEventHandler as EventListenerOrEventListenerObject);\n        input.removeEventListener('blur', blurEventHandler);\n        input.removeAttribute('role');\n        input.removeAttribute('aria-expanded');\n        input.removeAttribute('aria-autocomplete');\n        input.removeAttribute('aria-controls');\n        input.removeAttribute('aria-activedescendant');\n        input.removeAttribute('aria-owns');\n        input.removeAttribute('aria-haspopup');\n        clearDebounceTimer();\n        clear();\n        destroyed = true;\n    }\n\n    // setup event handlers\n    input.addEventListener('keyup', keyupEventHandler as EventListenerOrEventListenerObject);\n    input.addEventListener('click', clickEventHandler as EventListenerOrEventListenerObject);\n    input.addEventListener('keydown', keydownEventHandler as EventListenerOrEventListenerObject);\n    input.addEventListener('input', inputEventHandler as EventListenerOrEventListenerObject);\n    input.addEventListener('blur', blurEventHandler);\n    input.addEventListener('focus', focusEventHandler);\n\n    return {\n        destroy,\n        fetch: manualFetch\n    };\n}\n"],"names":[],"mappings":"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"}